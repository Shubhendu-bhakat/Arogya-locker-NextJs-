(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6589,e=>{e.v({bot:"chat-module__uNFIjq__bot",chatBox:"chat-module__uNFIjq__chatBox",chatContainer:"chat-module__uNFIjq__chatContainer",chatWrapper:"chat-module__uNFIjq__chatWrapper",fadeIn:"chat-module__uNFIjq__fadeIn",hiddenInput:"chat-module__uNFIjq__hiddenInput",imageMessage:"chat-module__uNFIjq__imageMessage",inputArea:"chat-module__uNFIjq__inputArea",message:"chat-module__uNFIjq__message",sendBtn:"chat-module__uNFIjq__sendBtn",textInput:"chat-module__uNFIjq__textInput",uploadLabel:"chat-module__uNFIjq__uploadLabel",user:"chat-module__uNFIjq__user"})},53836,e=>{"use strict";e.s(["default",()=>l]);var t=e.i(43476),a=e.i(71645),s=e.i(57688),r=e.i(6589);function l(e){let{firstName:l}=e,[i,n]=(0,a.useState)([]),[d,u]=(0,a.useState)(""),[o,c]=(0,a.useState)(null),m=(0,a.useRef)(null),h=(0,a.useRef)(null),p=(0,a.useCallback)(e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),[]),g=(0,a.useCallback)(e=>{var t,a,s,r;return"IMAGE"===e.messageType?{sender:"user",senderName:(null==(a=e.user)?void 0:a.username)||l,type:"image",imageUrl:null!=(s=e.mediaUrl)?s:void 0,time:p(e.createdAt)}:{sender:"user",senderName:(null==(t=e.user)?void 0:t.username)||l,type:"text",text:null!=(r=e.content)?r:"",time:p(e.createdAt)}},[l,p]);(0,a.useEffect)(()=>{let e=new WebSocket("ws://localhost:8080");return c(e),e.onmessage=e=>{n(t=>[...t,{sender:"bot",senderName:"ArogyaBot",text:e.data,type:"text",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])},()=>e.close()},[]),(0,a.useEffect)(()=>{var e;null==(e=h.current)||e.scrollIntoView({behavior:"smooth"})},[i]),(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/chat/messages",{method:"GET",credentials:"include"});if(!e.ok)throw Error("Failed to load chat history");let t=await e.json();if(null==t?void 0:t.data){let e=t.data.map(g);n(e)}}catch(e){console.error("Failed to fetch chat history",e)}})()},[g]);let f=async()=>{let e=d.trim();if(!e)return;let t={sender:"user",senderName:l,text:e,type:"text",time:p(Date.now())};n(e=>[...e,t]),u("");try{await fetch("/api/chat/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})})}catch(e){console.error("Failed to persist chat message",e)}null==o||o.send(e),setTimeout(()=>{n(e=>[...e,{sender:"bot",senderName:"ArogyaBot",text:"This is a standard response ðŸ¤–",type:"text",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])},800)},_=async e=>{if(!e)return;let t=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a=new FormData;a.append("file",e);try{var s;let e=await fetch("/api/chat/upload",{method:"POST",body:a});if(!e.ok)throw Error("Image upload failed");let{chatMessage:r,url:i}=await e.json(),d=r&&"IMAGE"===r.messageType?g({id:r.id,messageType:r.messageType,content:r.content,mediaUrl:null!=(s=r.mediaUrl)?s:i,createdAt:r.createdAt,user:r.user}):{sender:"user",senderName:l,imageUrl:i,type:"image",time:t};n(e=>[...e,d]),null==o||o.send(i),setTimeout(()=>{n(e=>[...e,{sender:"bot",senderName:"ArogyaBot",text:"âœ… Image received",type:"text",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])},800)}catch(e){console.error("Image upload failed",e)}finally{m.current&&(m.current.value="")}};return(0,t.jsx)("div",{className:r.default.chatWrapper,children:(0,t.jsxs)("div",{className:r.default.chatContainer,children:[(0,t.jsxs)("div",{className:r.default.chatBox,children:[i.map((e,a)=>(0,t.jsxs)("div",{className:"".concat(r.default.messageWrapper," ").concat("user"===e.sender?r.default.userWrapper:r.default.botWrapper),children:[(0,t.jsx)("span",{className:r.default.senderName,children:e.senderName}),(0,t.jsx)("div",{className:"".concat(r.default.message," ").concat("user"===e.sender?r.default.user:r.default.bot),children:"text"===e.type?(0,t.jsx)("p",{children:e.text}):e.imageUrl?(0,t.jsx)(s.default,{src:e.imageUrl,alt:"Uploaded",className:r.default.imageMessage,width:200,height:200,unoptimized:!0}):null}),(0,t.jsx)("span",{className:r.default.timestamp,children:e.time})]},a)),(0,t.jsx)("div",{ref:h})]}),(0,t.jsxs)("div",{className:r.default.inputArea,children:[(0,t.jsx)("input",{type:"text",placeholder:"Type your message...",value:d,onChange:e=>u(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(),className:r.default.textInput}),(0,t.jsx)("label",{htmlFor:"file-upload",className:r.default.uploadLabel,children:"ðŸ“· Upload"}),(0,t.jsx)("input",{type:"file",accept:"image/*",ref:m,onChange:e=>e.target.files&&_(e.target.files[0]),className:r.default.hiddenInput,id:"file-upload"}),(0,t.jsx)("button",{onClick:f,className:r.default.sendBtn,children:"Send"})]})]})})}}]);