{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/styles/chat.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"bot\": \"chat-module__uNFIjq__bot\",\n  \"chatBox\": \"chat-module__uNFIjq__chatBox\",\n  \"chatContainer\": \"chat-module__uNFIjq__chatContainer\",\n  \"chatWrapper\": \"chat-module__uNFIjq__chatWrapper\",\n  \"fadeIn\": \"chat-module__uNFIjq__fadeIn\",\n  \"hiddenInput\": \"chat-module__uNFIjq__hiddenInput\",\n  \"imageMessage\": \"chat-module__uNFIjq__imageMessage\",\n  \"inputArea\": \"chat-module__uNFIjq__inputArea\",\n  \"message\": \"chat-module__uNFIjq__message\",\n  \"sendBtn\": \"chat-module__uNFIjq__sendBtn\",\n  \"textInput\": \"chat-module__uNFIjq__textInput\",\n  \"uploadLabel\": \"chat-module__uNFIjq__uploadLabel\",\n  \"user\": \"chat-module__uNFIjq__user\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTS/Arogya-locker-final/arogya-locker-next/app/chat/chatClient.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState, useRef, useCallback } from \"react\";\r\nimport Image from \"next/image\";\r\nimport styles from \"../../styles/chat.module.css\";\r\n\r\ninterface Message {\r\n  sender: \"user\" | \"bot\";\r\n  senderName: string;\r\n  text?: string;\r\n  imageUrl?: string;\r\n  type: \"text\" | \"image\";\r\n  time: string;\r\n}\r\n\r\nexport default function ChatClient({ firstName }: { firstName: string }) {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [socket, setSocket] = useState<WebSocket | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\r\n  const chatEndRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  const formatTime = useCallback((value: string | number | Date) => {\r\n    return new Date(value).toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\r\n  }, []);\r\n\r\n  const mapServerMessage = useCallback(\r\n    (msg: {\r\n      id: number;\r\n      messageType: \"TEXT\" | \"IMAGE\";\r\n      content: string | null;\r\n      mediaUrl: string | null;\r\n      createdAt: string;\r\n      user?: { username: string | null };\r\n    }): Message => {\r\n      if (msg.messageType === \"IMAGE\") {\r\n        return {\r\n          sender: \"user\",\r\n          senderName: msg.user?.username || firstName,\r\n          type: \"image\",\r\n          imageUrl: msg.mediaUrl ?? undefined,\r\n          time: formatTime(msg.createdAt),\r\n        };\r\n      }\r\n\r\n      return {\r\n        sender: \"user\",\r\n        senderName: msg.user?.username || firstName,\r\n        type: \"text\",\r\n        text: msg.content ?? \"\",\r\n        time: formatTime(msg.createdAt),\r\n      };\r\n    },\r\n    [firstName, formatTime]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const ws = new WebSocket(\"ws://localhost:8080\"); // dummy backend\r\n    setSocket(ws);\r\n\r\n    ws.onmessage = (event) => {\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          sender: \"bot\",\r\n          senderName: \"ArogyaBot\",\r\n          text: event.data,\r\n          type: \"text\",\r\n          time: new Date().toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" }),\r\n        },\r\n      ]);\r\n    };\r\n\r\n    return () => ws.close();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    const fetchMessages = async () => {\r\n      try {\r\n        const response = await fetch(\"/api/chat/messages\", {\r\n          method: \"GET\",\r\n          credentials: \"include\",\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error(\"Failed to load chat history\");\r\n        }\r\n\r\n        const data = await response.json();\r\n        if (data?.data) {\r\n          const hydratedMessages = data.data.map(mapServerMessage);\r\n          setMessages(hydratedMessages);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Failed to fetch chat history\", error);\r\n      }\r\n    };\r\n\r\n    fetchMessages();\r\n  }, [mapServerMessage]);\r\n\r\n  const sendMessage = async () => {\r\n    const trimmedInput = input.trim();\r\n    if (!trimmedInput) return;\r\n\r\n    const now = formatTime(Date.now());\r\n    const userMessage: Message = {\r\n      sender: \"user\",\r\n      senderName: firstName,\r\n      text: trimmedInput,\r\n      type: \"text\",\r\n      time: now,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, userMessage]);\r\n    setInput(\"\");\r\n\r\n    try {\r\n      await fetch(\"/api/chat/messages\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ text: trimmedInput }),\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Failed to persist chat message\", error);\r\n    }\r\n\r\n    socket?.send(trimmedInput);\r\n\r\n    setTimeout(() => {\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          sender: \"bot\",\r\n          senderName: \"ArogyaBot\",\r\n          text: \"This is a standard response ðŸ¤–\",\r\n          type: \"text\",\r\n          time: new Date().toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" }),\r\n        },\r\n      ]);\r\n    }, 800);\r\n  };\r\n\r\n  const sendImage = async (file: File) => {\r\n    if (!file) return;\r\n\r\n    const now = new Date().toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\r\n    const formData = new FormData();\r\n    formData.append(\"file\", file);\r\n\r\n    try {\r\n      const response = await fetch(\"/api/chat/upload\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"Image upload failed\");\r\n      }\r\n\r\n      const { chatMessage, url } = await response.json();\r\n      const userImage =\r\n        chatMessage && chatMessage.messageType === \"IMAGE\"\r\n          ? mapServerMessage({\r\n              id: chatMessage.id,\r\n              messageType: chatMessage.messageType,\r\n              content: chatMessage.content,\r\n              mediaUrl: chatMessage.mediaUrl ?? url,\r\n              createdAt: chatMessage.createdAt,\r\n              user: chatMessage.user,\r\n            })\r\n          : {\r\n              sender: \"user\" as const,\r\n              senderName: firstName,\r\n              imageUrl: url,\r\n              type: \"image\" as const,\r\n              time: now,\r\n            };\r\n\r\n      setMessages((prev) => [...prev, userImage]);\r\n      socket?.send(url);\r\n\r\n      setTimeout(() => {\r\n        setMessages((prev) => [\r\n          ...prev,\r\n          {\r\n            sender: \"bot\",\r\n            senderName: \"ArogyaBot\",\r\n            text: \"âœ… Image received\",\r\n            type: \"text\",\r\n            time: new Date().toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" }),\r\n          },\r\n        ]);\r\n      }, 800);\r\n    } catch (error) {\r\n      console.error(\"Image upload failed\", error);\r\n    } finally {\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={styles.chatWrapper}>\r\n      <div className={styles.chatContainer}>\r\n        {/* Messages */}\r\n        <div className={styles.chatBox}>\r\n          {messages.map((msg, i) => (\r\n            <div\r\n              key={i}\r\n              className={`${styles.messageWrapper} ${\r\n                msg.sender === \"user\" ? styles.userWrapper : styles.botWrapper\r\n              }`}\r\n            >\r\n              <span className={styles.senderName}>{msg.senderName}</span>\r\n              <div\r\n                className={`${styles.message} ${\r\n                  msg.sender === \"user\" ? styles.user : styles.bot\r\n                }`}\r\n              >\r\n                {msg.type === \"text\" ? (\r\n                  <p>{msg.text}</p>\r\n                ) : msg.imageUrl ? (\r\n                  <Image\r\n                    src={msg.imageUrl}\r\n                    alt=\"Uploaded\"\r\n                    className={styles.imageMessage}\r\n                    width={200}\r\n                    height={200}\r\n                    unoptimized\r\n                  />\r\n                ) : null}\r\n              </div>\r\n              <span className={styles.timestamp}>{msg.time}</span>\r\n            </div>\r\n          ))}\r\n          <div ref={chatEndRef}></div>\r\n        </div>\r\n\r\n        {/* Input Area */}\r\n        <div className={styles.inputArea}>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Type your message...\"\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            onKeyDown={(e) => e.key === \"Enter\" && sendMessage()}\r\n            className={styles.textInput}\r\n          />\r\n\r\n          <label htmlFor=\"file-upload\" className={styles.uploadLabel}>\r\n            ðŸ“· Upload\r\n          </label>\r\n          <input\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            ref={fileInputRef}\r\n            onChange={(e) => e.target.files && sendImage(e.target.files[0])}\r\n            className={styles.hiddenInput}\r\n            id=\"file-upload\"\r\n          />\r\n\r\n          <button onClick={sendMessage} className={styles.sendBtn}>\r\n            Send\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}