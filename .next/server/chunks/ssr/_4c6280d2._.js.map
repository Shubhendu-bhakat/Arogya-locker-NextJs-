{"version":3,"sources":["turbopack:///[project]/styles/chat.module.css [app-ssr] (css module)","turbopack:///[project]/app/chat/chatClient.tsx"],"sourcesContent":["__turbopack_context__.v({\n  \"bot\": \"chat-module__uNFIjq__bot\",\n  \"chatBox\": \"chat-module__uNFIjq__chatBox\",\n  \"chatContainer\": \"chat-module__uNFIjq__chatContainer\",\n  \"chatWrapper\": \"chat-module__uNFIjq__chatWrapper\",\n  \"fadeIn\": \"chat-module__uNFIjq__fadeIn\",\n  \"hiddenInput\": \"chat-module__uNFIjq__hiddenInput\",\n  \"imageMessage\": \"chat-module__uNFIjq__imageMessage\",\n  \"inputArea\": \"chat-module__uNFIjq__inputArea\",\n  \"message\": \"chat-module__uNFIjq__message\",\n  \"sendBtn\": \"chat-module__uNFIjq__sendBtn\",\n  \"textInput\": \"chat-module__uNFIjq__textInput\",\n  \"uploadLabel\": \"chat-module__uNFIjq__uploadLabel\",\n  \"user\": \"chat-module__uNFIjq__user\",\n});\n","\"use client\";\r\n\r\nimport { useEffect, useState, useRef, useCallback } from \"react\";\r\nimport Image from \"next/image\";\r\nimport styles from \"../../styles/chat.module.css\";\r\n\r\ninterface Message {\r\n  sender: \"user\" | \"bot\";\r\n  senderName: string;\r\n  text?: string;\r\n  imageUrl?: string;\r\n  type: \"text\" | \"image\";\r\n  time: string;\r\n}\r\n\r\nexport default function ChatClient({ firstName }: { firstName: string }) {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [socket, setSocket] = useState<WebSocket | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\r\n  const chatEndRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  const formatTime = useCallback((value: string | number | Date) => {\r\n    return new Date(value).toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\r\n  }, []);\r\n\r\n  const mapServerMessage = useCallback(\r\n    (msg: {\r\n      id: number;\r\n      messageType: \"TEXT\" | \"IMAGE\";\r\n      content: string | null;\r\n      mediaUrl: string | null;\r\n      createdAt: string;\r\n      user?: { username: string | null };\r\n    }): Message => {\r\n      if (msg.messageType === \"IMAGE\") {\r\n        return {\r\n          sender: \"user\",\r\n          senderName: msg.user?.username || firstName,\r\n          type: \"image\",\r\n          imageUrl: msg.mediaUrl ?? undefined,\r\n          time: formatTime(msg.createdAt),\r\n        };\r\n      }\r\n\r\n      return {\r\n        sender: \"user\",\r\n        senderName: msg.user?.username || firstName,\r\n        type: \"text\",\r\n        text: msg.content ?? \"\",\r\n        time: formatTime(msg.createdAt),\r\n      };\r\n    },\r\n    [firstName, formatTime]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const ws = new WebSocket(\"ws://localhost:8080\"); // dummy backend\r\n    setSocket(ws);\r\n\r\n    ws.onmessage = (event) => {\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          sender: \"bot\",\r\n          senderName: \"ArogyaBot\",\r\n          text: event.data,\r\n          type: \"text\",\r\n          time: new Date().toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" }),\r\n        },\r\n      ]);\r\n    };\r\n\r\n    return () => ws.close();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    const fetchMessages = async () => {\r\n      try {\r\n        const response = await fetch(\"/api/chat/messages\", {\r\n          method: \"GET\",\r\n          credentials: \"include\",\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error(\"Failed to load chat history\");\r\n        }\r\n\r\n        const data = await response.json();\r\n        if (data?.data) {\r\n          const hydratedMessages = data.data.map(mapServerMessage);\r\n          setMessages(hydratedMessages);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Failed to fetch chat history\", error);\r\n      }\r\n    };\r\n\r\n    fetchMessages();\r\n  }, [mapServerMessage]);\r\n\r\n  const sendMessage = async () => {\r\n    const trimmedInput = input.trim();\r\n    if (!trimmedInput) return;\r\n\r\n    const now = formatTime(Date.now());\r\n    const userMessage: Message = {\r\n      sender: \"user\",\r\n      senderName: firstName,\r\n      text: trimmedInput,\r\n      type: \"text\",\r\n      time: now,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, userMessage]);\r\n    setInput(\"\");\r\n\r\n    try {\r\n      await fetch(\"/api/chat/messages\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ text: trimmedInput }),\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Failed to persist chat message\", error);\r\n    }\r\n\r\n    socket?.send(trimmedInput);\r\n\r\n    setTimeout(() => {\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          sender: \"bot\",\r\n          senderName: \"ArogyaBot\",\r\n          text: \"This is a standard response ðŸ¤–\",\r\n          type: \"text\",\r\n          time: new Date().toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" }),\r\n        },\r\n      ]);\r\n    }, 800);\r\n  };\r\n\r\n  const sendImage = async (file: File) => {\r\n    if (!file) return;\r\n\r\n    const now = new Date().toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\r\n    const formData = new FormData();\r\n    formData.append(\"file\", file);\r\n\r\n    try {\r\n      const response = await fetch(\"/api/chat/upload\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"Image upload failed\");\r\n      }\r\n\r\n      const { chatMessage, url } = await response.json();\r\n      const userImage =\r\n        chatMessage && chatMessage.messageType === \"IMAGE\"\r\n          ? mapServerMessage({\r\n              id: chatMessage.id,\r\n              messageType: chatMessage.messageType,\r\n              content: chatMessage.content,\r\n              mediaUrl: chatMessage.mediaUrl ?? url,\r\n              createdAt: chatMessage.createdAt,\r\n              user: chatMessage.user,\r\n            })\r\n          : {\r\n              sender: \"user\" as const,\r\n              senderName: firstName,\r\n              imageUrl: url,\r\n              type: \"image\" as const,\r\n              time: now,\r\n            };\r\n\r\n      setMessages((prev) => [...prev, userImage]);\r\n      socket?.send(url);\r\n\r\n      setTimeout(() => {\r\n        setMessages((prev) => [\r\n          ...prev,\r\n          {\r\n            sender: \"bot\",\r\n            senderName: \"ArogyaBot\",\r\n            text: \"âœ… Image received\",\r\n            type: \"text\",\r\n            time: new Date().toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" }),\r\n          },\r\n        ]);\r\n      }, 800);\r\n    } catch (error) {\r\n      console.error(\"Image upload failed\", error);\r\n    } finally {\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={styles.chatWrapper}>\r\n      <div className={styles.chatContainer}>\r\n        {/* Messages */}\r\n        <div className={styles.chatBox}>\r\n          {messages.map((msg, i) => (\r\n            <div\r\n              key={i}\r\n              className={`${styles.messageWrapper} ${\r\n                msg.sender === \"user\" ? styles.userWrapper : styles.botWrapper\r\n              }`}\r\n            >\r\n              <span className={styles.senderName}>{msg.senderName}</span>\r\n              <div\r\n                className={`${styles.message} ${\r\n                  msg.sender === \"user\" ? styles.user : styles.bot\r\n                }`}\r\n              >\r\n                {msg.type === \"text\" ? (\r\n                  <p>{msg.text}</p>\r\n                ) : msg.imageUrl ? (\r\n                  <Image\r\n                    src={msg.imageUrl}\r\n                    alt=\"Uploaded\"\r\n                    className={styles.imageMessage}\r\n                    width={200}\r\n                    height={200}\r\n                    unoptimized\r\n                  />\r\n                ) : null}\r\n              </div>\r\n              <span className={styles.timestamp}>{msg.time}</span>\r\n            </div>\r\n          ))}\r\n          <div ref={chatEndRef}></div>\r\n        </div>\r\n\r\n        {/* Input Area */}\r\n        <div className={styles.inputArea}>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Type your message...\"\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            onKeyDown={(e) => e.key === \"Enter\" && sendMessage()}\r\n            className={styles.textInput}\r\n          />\r\n\r\n          <label htmlFor=\"file-upload\" className={styles.uploadLabel}>\r\n            ðŸ“· Upload\r\n          </label>\r\n          <input\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            ref={fileInputRef}\r\n            onChange={(e) => e.target.files && sendImage(e.target.files[0])}\r\n            className={styles.hiddenInput}\r\n            id=\"file-upload\"\r\n          />\r\n\r\n          <button onClick={sendMessage} className={styles.sendBtn}>\r\n            Send\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}