module.exports=[56267,a=>{a.v({bot:"chat-module__uNFIjq__bot",chatBox:"chat-module__uNFIjq__chatBox",chatContainer:"chat-module__uNFIjq__chatContainer",chatWrapper:"chat-module__uNFIjq__chatWrapper",fadeIn:"chat-module__uNFIjq__fadeIn",hiddenInput:"chat-module__uNFIjq__hiddenInput",imageMessage:"chat-module__uNFIjq__imageMessage",inputArea:"chat-module__uNFIjq__inputArea",message:"chat-module__uNFIjq__message",sendBtn:"chat-module__uNFIjq__sendBtn",textInput:"chat-module__uNFIjq__textInput",uploadLabel:"chat-module__uNFIjq__uploadLabel",user:"chat-module__uNFIjq__user"})},11406,a=>{"use strict";a.s(["default",()=>f]);var b=a.i(87924),c=a.i(72131),d=a.i(71987),e=a.i(56267);function f({firstName:a}){let[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(null),l=(0,c.useRef)(null),m=(0,c.useRef)(null),n=(0,c.useCallback)(a=>new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),[]),o=(0,c.useCallback)(b=>"IMAGE"===b.messageType?{sender:"user",senderName:b.user?.username||a,type:"image",imageUrl:b.mediaUrl??void 0,time:n(b.createdAt)}:{sender:"user",senderName:b.user?.username||a,type:"text",text:b.content??"",time:n(b.createdAt)},[a,n]);(0,c.useEffect)(()=>{let a=new WebSocket("ws://localhost:8080");return k(a),a.onmessage=a=>{g(b=>[...b,{sender:"bot",senderName:"ArogyaBot",text:a.data,type:"text",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])},()=>a.close()},[]),(0,c.useEffect)(()=>{m.current?.scrollIntoView({behavior:"smooth"})},[f]),(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/chat/messages",{method:"GET",credentials:"include"});if(!a.ok)throw Error("Failed to load chat history");let b=await a.json();if(b?.data){let a=b.data.map(o);g(a)}}catch(a){console.error("Failed to fetch chat history",a)}})()},[o]);let p=async()=>{let b=h.trim();if(!b)return;let c={sender:"user",senderName:a,text:b,type:"text",time:n(Date.now())};g(a=>[...a,c]),i("");try{await fetch("/api/chat/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:b})})}catch(a){console.error("Failed to persist chat message",a)}j?.send(b),setTimeout(()=>{g(a=>[...a,{sender:"bot",senderName:"ArogyaBot",text:"This is a standard response ðŸ¤–",type:"text",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])},800)},q=async b=>{if(!b)return;let c=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d=new FormData;d.append("file",b);try{let b=await fetch("/api/chat/upload",{method:"POST",body:d});if(!b.ok)throw Error("Image upload failed");let{chatMessage:e,url:f}=await b.json(),h=e&&"IMAGE"===e.messageType?o({id:e.id,messageType:e.messageType,content:e.content,mediaUrl:e.mediaUrl??f,createdAt:e.createdAt,user:e.user}):{sender:"user",senderName:a,imageUrl:f,type:"image",time:c};g(a=>[...a,h]),j?.send(f),setTimeout(()=>{g(a=>[...a,{sender:"bot",senderName:"ArogyaBot",text:"âœ… Image received",type:"text",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])},800)}catch(a){console.error("Image upload failed",a)}finally{l.current&&(l.current.value="")}};return(0,b.jsx)("div",{className:e.default.chatWrapper,children:(0,b.jsxs)("div",{className:e.default.chatContainer,children:[(0,b.jsxs)("div",{className:e.default.chatBox,children:[f.map((a,c)=>(0,b.jsxs)("div",{className:`${e.default.messageWrapper} ${"user"===a.sender?e.default.userWrapper:e.default.botWrapper}`,children:[(0,b.jsx)("span",{className:e.default.senderName,children:a.senderName}),(0,b.jsx)("div",{className:`${e.default.message} ${"user"===a.sender?e.default.user:e.default.bot}`,children:"text"===a.type?(0,b.jsx)("p",{children:a.text}):a.imageUrl?(0,b.jsx)(d.default,{src:a.imageUrl,alt:"Uploaded",className:e.default.imageMessage,width:200,height:200,unoptimized:!0}):null}),(0,b.jsx)("span",{className:e.default.timestamp,children:a.time})]},c)),(0,b.jsx)("div",{ref:m})]}),(0,b.jsxs)("div",{className:e.default.inputArea,children:[(0,b.jsx)("input",{type:"text",placeholder:"Type your message...",value:h,onChange:a=>i(a.target.value),onKeyDown:a=>"Enter"===a.key&&p(),className:e.default.textInput}),(0,b.jsx)("label",{htmlFor:"file-upload",className:e.default.uploadLabel,children:"ðŸ“· Upload"}),(0,b.jsx)("input",{type:"file",accept:"image/*",ref:l,onChange:a=>a.target.files&&q(a.target.files[0]),className:e.default.hiddenInput,id:"file-upload"}),(0,b.jsx)("button",{onClick:p,className:e.default.sendBtn,children:"Send"})]})]})})}}];

//# sourceMappingURL=_4c6280d2._.js.map